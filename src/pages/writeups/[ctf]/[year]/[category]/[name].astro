---
import { type CollectionEntry, getCollection } from "astro:content";
import PageLayout from "@layouts/PageLayout.astro";
import Container from "@components/Container.astro";
import FormattedDate from "@components/FormattedDate.astro";
import { readingTime } from "@lib/utils";
import BackToPrev from "@components/BackToPrev.astro";
import { parseWriteUp, type WriteUp } from "@lib/writeup";

export async function getStaticPaths() {
  const writeups = await Promise.all(
    (await getCollection("writeups")).map((writeup) => parseWriteUp(writeup)),
  );

  for (const writeup of writeups) {
    if (writeup.data.title === "Study Music") {
      console.log(writeup);
    }
  }

  return writeups.map((writeup) => ({
    params: {
      ctf: writeup.ctf.data.title.toLowerCase(),
      year: writeup.ctf.data.dateStart.getFullYear().toString(),
      category: writeup.category,
      name: writeup.fileName,
    },
    props: writeup,
  }));
}
type Props = WriteUp;

const writeup = Astro.props;
const { Content } = await writeup.render();
---

<PageLayout title={writeup.data.title} description={writeup.data.description}>
  <Container>
    <div class="animate">
      <BackToPrev> Go back </BackToPrev>
    </div>
    <div class="space-y-1 my-10">
      <div class="animate flex items-center gap-1.5">
        {
          writeup.data.date ? (
            <>
              <div class="font-base text-sm">
                <FormattedDate date={writeup.data.date} />
              </div>
              &bull;
            </>
          ) : null
        }
        <div class="font-base text-sm">
          {readingTime(writeup.body)}
        </div>
      </div>
      <div class="animate text-2xl font-semibold text-black dark:text-white">
        {writeup.ctf.data.title} - {writeup.data.title}
      </div>

      <section class="animate">
        <!-- create table with Points, Solves, points: X \nsolves: X -->
        <table class="table-auto">
          <tbody>
            <tr>
              <td class="font-semibold">Category</td>
              <td>{writeup.category}</td>
            </tr>
            <tr>
              <td class="font-semibold">Points</td>
              <td>{writeup.data.points}</td>
            </tr>
            <tr>
              <td class="font-semibold">Solves</td>
              <td>{writeup.data.solves}</td>
            </tr>
          </tbody>
        </table>
      </section>

      <article class="animate">
        <Content />
      </article>
    </div>
  </Container>
</PageLayout>
